import{b as c,p as i}from"./api.js";async function d(e){try{return(await c.post("https://deserving-apparel-f938801c39.strapiapp.com/api/auth/reset-password",e)).data}catch(t){throw console.log("error:",t.response?.data),t}}async function m(e){console.log(e),await c.post("https://deserving-apparel-f938801c39.strapiapp.com/api/auth/forgot-password",{email:`${e}`}).then(t=>{console.log("Your user received an email")}).catch(t=>{console.log("An error occurred:",t.response)})}const p=document.querySelectorAll(".tab"),g=document.querySelectorAll(".content__item"),u=new URLSearchParams(window.location.search),w=u.get("tab");document.addEventListener("DOMContentLoaded",()=>{function e(){return localStorage.getItem("Logged")==="true"}document.querySelectorAll(".profile__body-img").forEach(r=>r.addEventListener("click",o=>{o.preventDefault(),e()?window.location.replace("/ClubTravel/html/pages/profile.html"):window.location.replace("/ClubTravel/html/pages/authorization.html?tab=authorization")}))});function l(e){g.forEach(t=>t.classList.toggle("active",t.classList.contains(e)))}l(w);p.forEach(e=>{e.addEventListener("click",()=>l(e.dataset.tab))});const f=document.getElementById("registerForm");async function h(e){const t=new FormData(e.target),r=Object.fromEntries(t);if(r.password!==r.passwordRepeat){console.log("паролі не співпадають");return}const o=await i("https://deserving-apparel-f938801c39.strapiapp.com/api/auth/local/register",{username:r.email,email:r.email,password:r.password});if(o.error){console.log(o.error.message);return}o.jwt&&o.user&&(localStorage.setItem("jwt",o.jwt),localStorage.setItem("Logged","true"))}f&&document.getElementById("registerForm").addEventListener("submit",h);const E=document.getElementById("loginForm");async function y(e){e.preventDefault();const t=new FormData(e.target),r=Object.fromEntries(t);try{const o=await i("https://deserving-apparel-f938801c39.strapiapp.com/api/auth/local",{identifier:r.identifier,password:r.password});o.jwt&&o.user&&(localStorage.setItem("Logged","true"),localStorage.setItem("username",r.identifier),localStorage.setItem("userId",o.user.id),localStorage.setItem("token",o.jwt),localStorage.setItem("jwt",o.jwt),window.location.href="/ClubTravel/html/pages/profile.html")}catch(o){console.error("Login failed:",o.message)}}E&&document.getElementById("loginForm").addEventListener("submit",y);const I=document.getElementById("reset");I&&document.getElementById("reset").addEventListener("click",()=>{const e=document.getElementById("emailReset").value;m(e)});async function b(e){e.preventDefault();const t=new FormData(e.target),r=Object.fromEntries(t),n=new URLSearchParams(window.location.search).get("code");if(!n){console.error("No reset code in URL!");return}const s={code:n,password:r.password,passwordConfirmation:r.passwordRepeat};if(s.password!==s.passwordConfirmation){console.error("не співпадають паролі");return}try{const a=await d(s);console.log("reset done:",a)}catch(a){console.error("error:",a.response?.data??a.message)}}const v=document.getElementById("newPasswordForm");v&&document.getElementById("newPasswordForm").addEventListener("submit",b);
