import{a as c,p as i}from"./api.js";async function d(e){try{return(await c.post("https://deserving-apparel-f938801c39.strapiapp.com/api/auth/reset-password",e)).data}catch(t){throw console.log("error:",t.response?.data),t}}async function m(e){console.log(e),await c.post("https://deserving-apparel-f938801c39.strapiapp.com/api/auth/forgot-password",{email:`${e}`}).then(t=>{console.log("Your user received an email")}).catch(t=>{console.log("An error occurred:",t.response)})}const p=document.querySelectorAll(".tab"),u=document.querySelectorAll(".content__item"),g=new URLSearchParams(window.location.search),w=g.get("tab");document.addEventListener("DOMContentLoaded",()=>{function e(){return localStorage.getItem("Logged")==="true"}document.querySelectorAll(".profile__body-img").forEach(o=>o.addEventListener("click",r=>{r.preventDefault(),e()?window.location.replace("/ClubTravel/html/pages/profile.html"):window.location.replace("/ClubTravel/html/pages/authorization.html?tab=authorization")}))});function l(e){u.forEach(t=>t.classList.toggle("active",t.classList.contains(e)))}l(w);p.forEach(e=>{e.addEventListener("click",()=>l(e.dataset.tab))});const f=document.getElementById("registerForm");async function h(e){e.preventDefault();const t=new FormData(e.target),o=Object.fromEntries(t);if(o.password!==o.passwordRepeat){console.log("паролі не співпадають");return}const r=await i("https://deserving-apparel-f938801c39.strapiapp.com/api/auth/local/register",{username:o.email,email:o.email,password:o.password});if(r.error){console.log(r.error.message);return}window.location.replace("/ClubTravel/html/pages/authorization.html?tab=authorization")}f&&document.getElementById("registerForm").addEventListener("submit",h);const E=document.getElementById("loginForm");async function y(e){e.preventDefault();const t=new FormData(e.target),o=Object.fromEntries(t);try{const r=await i("https://deserving-apparel-f938801c39.strapiapp.com/api/auth/local",{identifier:o.identifier,password:o.password});r.jwt&&r.user&&(localStorage.setItem("Logged","true"),localStorage.setItem("username",o.identifier),localStorage.setItem("userId",r.user.id),localStorage.setItem("token",r.jwt),localStorage.setItem("jwt",r.jwt),window.location.href="/ClubTravel/html/pages/profile.html")}catch(r){console.error("Login failed:",r.message)}}E&&document.getElementById("loginForm").addEventListener("submit",y);const b=document.getElementById("reset");b&&document.getElementById("reset").addEventListener("click",()=>{const e=document.getElementById("emailReset").value;m(e)});async function v(e){e.preventDefault();const t=new FormData(e.target),o=Object.fromEntries(t),n=new URLSearchParams(window.location.search).get("code");if(!n){console.error("No reset code in URL!");return}const s={code:n,password:o.password,passwordConfirmation:o.passwordRepeat};if(s.password!==s.passwordConfirmation){console.error("не співпадають паролі");return}try{const a=await d(s);console.log("reset done:",a)}catch(a){console.error("error:",a.response?.data??a.message)}}const I=document.getElementById("newPasswordForm");I&&document.getElementById("newPasswordForm").addEventListener("submit",v);
